# This file demonstrates the ExternalSecret pattern using External Secrets Operator
# Requires: External Secrets Operator (https://external-secrets.io)
#
# Before applying, ensure:
# 1. External Secrets Operator is installed in your cluster
# 2. SecretStore is configured (e.g., AWS Secrets Manager, GCP Secret Manager, Vault)
# 3. Secrets exist in your secret backend
#
# Alternative: If not using External Secrets Operator, create a regular Secret:
#   kubectl create secret generic soroscan-secrets \
#     --from-literal=SECRET_KEY='your-django-secret-key' \
#     --from-literal=DATABASE_URL='postgresql://user:pass@host:5432/dbname' \
#     --from-literal=REDIS_URL='redis://redis:6379/0' \
#     --from-literal=SOROSCAN_CONTRACT_ID='your-contract-id' \
#     --from-literal=INDEXER_SECRET_KEY='your-indexer-key' \
#     -n soroscan

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: soroscan-secrets
  namespace: soroscan
spec:
  refreshInterval: 1h
  secretStoreRef:
    # Reference to your SecretStore (configured separately)
    name: secretstore-backend  # Change to your SecretStore name
    kind: SecretStore
  target:
    name: soroscan-secrets
    creationPolicy: Owner
  data:
    - secretKey: SECRET_KEY
      remoteRef:
        key: soroscan/django-secret-key
    
    - secretKey: DATABASE_URL
      remoteRef:
        key: soroscan/database-url
    
    - secretKey: REDIS_URL
      remoteRef:
        key: soroscan/redis-url
    
    - secretKey: SOROSCAN_CONTRACT_ID
      remoteRef:
        key: soroscan/contract-id
    
    - secretKey: INDEXER_SECRET_KEY
      remoteRef:
        key: soroscan/indexer-secret-key
    
    # Optional: Sentry DSN for error tracking
    - secretKey: SENTRY_DSN
      remoteRef:
        key: soroscan/sentry-dsn
        optional: true
